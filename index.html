<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Agenda de Médicos — Consulta</title>
 <link rel="stylesheet" href="./styles.css" />
<script src="./app.js" defer></script>
  
</head>

<body>
  <!-- Login Overlay -->
  <div class="login-overlay" id="loginOverlay" aria-hidden="false">
    <div class="login-card">
      <h2>Acesso</h2>
      <p>Este bloqueio é <b>apenas</b> para evitar acesso casual. Como é um site estático (GitHub Pages), quem souber inspecionar o código pode descobrir a senha.</p>
      <label for="user">Usuário</label>
      <input id="user" autocomplete="username" />
      <label for="pass">Senha</label>
      <input id="pass" type="password" autocomplete="current-password" />
      <div class="login-actions">
        <button class="login-btn" id="loginBtn" type="button">Entrar</button>
      </div>
      <div class="login-err" id="loginErr">Usuário ou senha inválidos.</div>
      <div class="login-note">Dica: para segurança real, usar autenticação de verdade (Cloudflare Access/Netlify/Backend).</div>
    </div>
  </div>

  <header class="topbar">
    <div class="topbar-inner">
      <div class="brand">
        <div>
          <h1>Consulta rápida — atendimentos</h1>
          <div class="subtitle">Filtre por dia, rota, período e agendamento</div>
        </div>

        <!-- Logo do Aché (suba em assets/logo-ache.png) -->
        <img class="brand-logo" src="./assets/logo-ache.png" alt="Aché" onerror="this.style.display='none';" />
      </div>

      <div class="row" id="days"></div>

      <div class="row">
        <input id="q" class="search" placeholder="Buscar por médico, cidade, especialidade, bairro, observação..." />
      </div>

      <div class="row">
        <select id="rota" class="select">
          <option value="TODAS">Todas as rotas</option>
          <option value="Piracicaba">Piracicaba</option>
          <option value="São Pedro">São Pedro</option>
        </select>

        <select id="ag" class="select">
          <option value="TODOS">Agendado? (Todos)</option>
          <option value="S">Somente AGENDADOS</option>
          <option value="N">Somente NÃO agendados</option>
        </select>

        <div class="toggle" id="periodo">
          <button type="button" class="toggle-btn active" data-p="AMBOS">Ambos</button>
          <button type="button" class="toggle-btn" data-p="MANHA">Manhã</button>
          <button type="button" class="toggle-btn" data-p="TARDE">Tarde</button>
        </div>
      </div>

      <div class="row actions">
        <div class="meta" id="meta">Carregando…</div>

        <div class="btn-group">
          <button class="btn btn-ghost" id="applyBtn" type="button">Aplicar filtros (OK)</button>
          <button class="btn btn-primary" id="refreshBtn" type="button">Atualizar agora</button>
        </div>
      </div>

      <div class="meta" id="updatedAt"></div>
    </div>
  </header>

  <main class="container">
    <div class="grid" id="list"></div>
    <div class="footer" id="footer"></div>
  </main>

  <script src="./app.js"></script>

  <!-- Login script -->
  <script>
    // ⚠️ Bloqueio simples (client-side). NÃO é segurança real.
    const AUTH_USER = "Murilo";
    const AUTH_PASS = "@@13Nov2016";
    const KEY = "agenda_auth_ok_v1";

    function showLogin(show){
      const ov = document.getElementById("loginOverlay");
      if(!ov) return;
      ov.style.display = show ? "flex" : "none";
      ov.setAttribute("aria-hidden", show ? "false" : "true");
    }

    function setErr(show){
      const el = document.getElementById("loginErr");
      if(!el) return;
      el.style.display = show ? "block" : "none";
    }

    function initLogin(){
      try{
        if (sessionStorage.getItem(KEY) === "1"){
          showLogin(false);
          return;
        }
      }catch(e){}

      showLogin(true);

      const btn = document.getElementById("loginBtn");
      const u = document.getElementById("user");
      const p = document.getElementById("pass");

      function attempt(){
        const ok = (u.value === AUTH_USER && p.value === AUTH_PASS);
        if(ok){
          try{ sessionStorage.setItem(KEY,"1"); }catch(e){}
          setErr(false);
          showLogin(false);
        } else {
          setErr(true);
        }
      }

      btn.addEventListener("click", attempt);
      p.addEventListener("keydown", (e)=>{ if(e.key==="Enter") attempt(); });
      u.addEventListener("keydown", (e)=>{ if(e.key==="Enter") attempt(); });
    }

    if (document.readyState === "loading") {
      document.addEventListener("DOMContentLoaded", initLogin);
    } else {
      initLogin();
    }
  </script>
</body>
</html>
